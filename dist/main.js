"use strict";var Fe=Object.defineProperty,Te=Object.defineProperties;var Oe=Object.getOwnPropertyDescriptors;var _e=Object.getOwnPropertySymbols;var Be=Object.prototype.hasOwnProperty,ze=Object.prototype.propertyIsEnumerable;var $e=(r,e,n)=>e in r?Fe(r,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[e]=n,me=(r,e)=>{for(var n in e||(e={}))Be.call(e,n)&&$e(r,n,e[n]);if(_e)for(var n of _e(e))ze.call(e,n)&&$e(r,n,e[n]);return r},Ae=(r,e)=>Te(r,Oe(e));const J={serverPort:3055,channelId:"hellofigma",isConnected:!1};function We(){figma.showUI(__html__,{width:300,height:380,themeColors:!0}),Ue(),figma.ui.onmessage=async e=>{if(!e||typeof e.type!="string"){figma.notify("Invalid message received from UI",{error:!0});return}switch(e.type){case"update-settings":Ve(e);break;case"notify":if(e.message){const n={timeout:e.timeout||3e3,error:e.error||!1};figma.notify(e.message,n)}else figma.notify("Empty notification message received",{error:!0});break;case"close-plugin":try{await figma.clientStorage.setAsync("lastSession",{timestamp:new Date().toISOString(),selectionCount:figma.currentPage.selection.length}),figma.closePlugin("👋 Figmation session ended. Thanks for using Figmation!")}catch(n){console.warn("Error during plugin cleanup:",n),figma.closePlugin()}break;default:console.warn(`Unknown message type received: ${e.type}`,e),figma.notify(`Unknown message type: ${e.type}`,{error:!0});break;case"execute-command":if(!e.command){figma.notify("No command specified in request",{error:!0}),figma.ui.postMessage({type:"command-error",id:e.id,error:"Missing command parameter"});return}try{figma.notify(`Executing command: ${e.command}...`,{timeout:2e3});const n=await De(e.command,e.params);figma.notify(`✅ Command '${e.command}' completed successfully`,{timeout:3e3}),figma.ui.postMessage({type:"command-result",id:e.id,result:n,command:e.command,timestamp:new Date().toISOString()})}catch(n){const i=(n==null?void 0:n.message)||"Unknown error occurred";figma.notify(`❌ Error: ${i}`,{error:!0,timeout:5e3}),console.error(`Command '${e.command}' failed:`,{error:i,command:e.command,params:e.params,timestamp:new Date().toISOString(),stack:n==null?void 0:n.stack}),figma.ui.postMessage({type:"command-error",id:e.id,error:i,command:e.command,timestamp:new Date().toISOString()})}break}},figma.on("run",({command:e})=>{figma.ui.postMessage({type:"auto-connect"})}),figma.on("selectionchange",()=>{r()});function r(){const e=figma.currentPage.selection;figma.ui.postMessage({type:"selection-changed",selectionCount:e.length,selection:e.map(n=>({id:n.id,name:n.name,type:n.type}))})}}function Ve(r){console.log("💾 Plugin: Updating settings...",r),r.serverPort&&(J.serverPort=r.serverPort),r.channelId!==void 0&&(J.channelId=r.channelId),figma.clientStorage.setAsync("settings",{serverPort:J.serverPort,channelId:J.channelId}).then(()=>{console.log("✅ Settings saved successfully"),figma.notify("Settings saved successfully!",{timeout:2e3})}).catch(e=>{console.error("❌ Failed to save settings:",e),figma.notify("Failed to save settings",{error:!0,timeout:3e3})})}async function Ue(){try{const r=await figma.clientStorage.getAsync("settings");r&&(r.serverPort&&(J.serverPort=r.serverPort),r.serverHost&&(J.serverHost=r.serverHost),r.channelId!==void 0&&(J.channelId=r.channelId)),figma.ui.postMessage({type:"init-settings",settings:{serverPort:J.serverPort,serverHost:J.serverHost,channelId:J.channelId}})}catch(r){console.error("Error loading settings:",r)}}async function De(r,e){if(!r||typeof r!="string")throw new Error("Invalid command: Command must be a non-empty string");const n=["create_rectangle","create_frame","create_text","create_ellipse","create_vector_path","create_button","create_boolean_operation","create_icon_from_svg","create_input_field","create_checkbox","create_toggle","create_symbol","create_avatar","create_progress_bar","create_slider","create_image_from_url","create_group"];if(n.includes(r)&&figma.editorType!=="figma")throw new Error(`Design mode required: The command '${r}' can only be executed in Figma's Design mode. Please switch from Dev mode to Design mode and try again.`);try{switch(r){case"get_document_info":return await He();case"get_selection":return await Ze();case"get_node_info":if(!e||!e.nodeId)throw new Error("Missing nodeId parameter");return await qe(e.nodeId);case"create_rectangle":return await Je(e);case"create_frame":return await Xe(e);case"create_text":return await Ke(e);case"set_fill_color":return await Ye(e);case"set_stroke_color":return await je(e);case"move_node":return await Qe(e);case"resize_node":return await et(e);case"delete_node":return await tt(e);case"clone_node":return await ot(e);case"export_node_as_image":return await rt(e);case"get_nodes_info":return await it(e);case"set_text_content":return await at(e);case"get_styles":return await st();case"search_available_fonts":return await dt(e);case"get_local_components":return await ct();case"create_component_instance":return await lt(e);case"set_corner_radius":return await ft(e);case"set_opacity":return await gt(e);case"set_rotation":return await ut(e);case"add_drop_shadow":return await ht(e);case"add_inner_shadow":return await mt(e);case"add_blur":return await pt(e);case"set_individual_corner_radius":return await yt(e);case"scan_text_nodes":return await wt(e);case"scan_nodes_by_types":return await It(e);case"set_multiple_text_contents":return await vt(e);case"delete_multiple_nodes":return await bt(e);case"set_layout_mode":return await Et(e);case"set_padding":return await At(e);case"set_axis_align":return await Rt(e);case"set_layout_sizing":return await xt(e);case"set_item_spacing":return await Nt(e);case"get_annotations":return await Ct(e);case"set_annotation":return await kt(e);case"get_instance_overrides":return await St(e);case"set_instance_overrides":return await Mt(e);case"get_reactions":return await _t(e);case"set_default_connector":return await $t(e);case"create_connections":return await Pt(e);case"create_image_from_url":return await Dt(e);case"create_slider":return await Lt(e);case"create_ellipse":return await Ft(e);case"create_vector_path":return await Ut(e);case"create_button":return await Gt(e);case"create_boolean_operation":return await Ht(e);case"create_icon_from_svg":return await Zt(e);case"create_svg_to_vector":return await Qt(e);case"create_group":return await to(e);case"execute_custom_command":return await eo(e);case"create_input_field":return await qt(e);case"create_checkbox":return await Jt(e);case"create_toggle":return await Xt(e);case"create_symbol":return await Kt(e);case"create_avatar":return await Yt(e);case"create_progress_bar":return await jt(e);default:throw new Error(`Unknown command: '${r}'. Available commands include: get_document_info, get_selection, create_rectangle, create_frame, create_text, and ${n.length} other node creation commands. Please check the command name and try again.`)}}catch(i){const o=(i==null?void 0:i.message)||"An unexpected error occurred";throw o.includes("Node not found")?new Error(`${o}. This usually happens when a node has been deleted or the ID is incorrect. Please verify the node exists and try again.`):o.includes("Permission denied")||o.includes("not allowed")?new Error(`${o}. Please check that you have the necessary permissions and that Figma is in the correct mode for this operation.`):o.includes("Network")||o.includes("fetch")?new Error(`Network error: ${o}. Please check your internet connection and ensure the external resources are accessible.`):o.includes("Font")||o.includes("loadFont")?new Error(`Font loading error: ${o}. The required font may not be available. Figma will attempt to use a fallback font.`):new Error(`Command '${r}' failed: ${o}`)}}function Re(r){if(r=r.replace("#",""),r.length===3&&(r=r.split("").map(o=>o+o).join("")),r.length!==6)throw new Error("Invalid hex color format");const e=parseInt(r.substring(0,2),16)/255,n=parseInt(r.substring(2,4),16)/255,i=parseInt(r.substring(4,6),16)/255;return{r:e,g:n,b:i}}function F(r){if(!r||typeof r!="object")throw new Error("Color must be an object with r, g, b properties");const{r:e,g:n,b:i,a:o=1}=r;if(typeof e!="number"||e<0||e>1)throw new Error("Red value (r) must be a number between 0 and 1");if(typeof n!="number"||n<0||n>1)throw new Error("Green value (g) must be a number between 0 and 1");if(typeof i!="number"||i<0||i>1)throw new Error("Blue value (b) must be a number between 0 and 1");if(typeof o!="number"||o<0||o>1)throw new Error("Alpha value (a) must be a number between 0 and 1");return{type:"SOLID",color:{r:e,g:n,b:i},opacity:o}}function Ge(r){if(!r||typeof r!="object")throw new Error("Gradient parameters must be an object");const{type:e,startColor:n,endColor:i,angle:o=0}=r;let c,a;try{c=Re(n),a=Re(i)}catch(s){throw new Error(`Invalid gradient color format: ${s.message}`)}const f=[{position:0,color:Ae(me({},c),{a:1})},{position:1,color:Ae(me({},a),{a:1})}],d=o*Math.PI/180;let t;switch(e.toUpperCase()){case"LINEAR_GRADIENT":return t=[[Math.cos(d),Math.sin(d),.5-.5*Math.cos(d)-.5*Math.sin(d)],[-Math.sin(d),Math.cos(d),.5+.5*Math.sin(d)-.5*Math.cos(d)]],{type:"GRADIENT_LINEAR",gradientTransform:t,gradientStops:f};case"RADIAL_GRADIENT":return t=[[1,0,0],[0,1,0]],{type:"GRADIENT_RADIAL",gradientTransform:t,gradientStops:f};case"ANGULAR_GRADIENT":return t=[[Math.cos(d),Math.sin(d),.5],[-Math.sin(d),Math.cos(d),.5]],{type:"GRADIENT_ANGULAR",gradientTransform:t,gradientStops:f};case"DIAMOND_GRADIENT":return t=[[Math.cos(d),Math.sin(d),.5],[-Math.sin(d),Math.cos(d),.5]],{type:"GRADIENT_DIAMOND",gradientTransform:t,gradientStops:f};default:throw new Error(`Unsupported gradient type: ${e}`)}}async function xe(r,e){if(e){const n=await figma.getNodeByIdAsync(e);if(!n)throw new Error(`Parent node not found with ID: ${e}`);if(!("appendChild"in n))throw new Error(`Parent node (${n.type}) does not support children`);return n.appendChild(r),n.id}else return figma.currentPage.appendChild(r),figma.currentPage.id}function Ne(r,e){return e&&typeof e=="string"&&e.trim()!==""?e.trim():`${r}_${Date.now()}`}async function He(){await figma.currentPage.loadAsync();const r=figma.currentPage;return{name:r.name,nodeId:r.id,id:r.id,type:r.type,children:r.children.map(e=>({nodeId:e.id,id:e.id,name:e.name,type:e.type})),currentPage:{nodeId:r.id,id:r.id,name:r.name,childCount:r.children.length},pages:figma.root.children.map(e=>({nodeId:e.id,id:e.id,name:e.name,childCount:e.children.length}))}}async function Ze(){return{selectionCount:figma.currentPage.selection.length,selection:figma.currentPage.selection.map(r=>({nodeId:r.id,id:r.id,name:r.name,type:r.type,visible:r.visible}))}}async function qe(r){const e=await figma.getNodeByIdAsync(r);if(!e)throw new Error(`Node not found with ID: ${r}`);return{nodeId:e.id,id:e.id,name:e.name,type:e.type,visible:e.visible,locked:e.locked,x:"x"in e?e.x:void 0,y:"y"in e?e.y:void 0,width:"width"in e?e.width:void 0,height:"height"in e?e.height:void 0,fills:"fills"in e?e.fills:void 0,strokes:"strokes"in e?e.strokes:void 0,cornerRadius:"cornerRadius"in e?e.cornerRadius:void 0,topLeftRadius:"topLeftRadius"in e?e.topLeftRadius:void 0,topRightRadius:"topRightRadius"in e?e.topRightRadius:void 0,bottomLeftRadius:"bottomLeftRadius"in e?e.bottomLeftRadius:void 0,bottomRightRadius:"bottomRightRadius"in e?e.bottomRightRadius:void 0,opacity:"opacity"in e?e.opacity:void 0,blendMode:"blendMode"in e?e.blendMode:void 0,rotation:"rotation"in e?e.rotation:void 0}}async function Je(r){const{x:e=0,y:n=0,width:i=100,height:o=100,name:c=`Rectangle_${Date.now()}`,parentId:a,fills:f,fillColor:d,strokes:t,strokeColor:s,strokeWeight:l,strokeCap:g,strokeJoin:u,strokeAlign:w,dashPattern:p,opacity:y,blendMode:b,cornerRadius:E,topLeftRadius:C,topRightRadius:$,bottomLeftRadius:T,bottomRightRadius:O,individualCornerRadius:B,rotation:z,visible:U,locked:L,effects:X,shadows:P,blurs:D,constraints:G,relativeTransform:H,clipsContent:W,guides:Y,selection:j,opacity:se,isMask:v,maskType:R,exportSettings:x,overflowDirection:Z,numberOfFixedChildren:oe,overlayPositionType:le,overlayBackground:fe,overlayBackgroundInteraction:ge,relaunch:re,reactions:ne,componentPropertyReferences:ie}=r||{};if(typeof e!="number"||typeof n!="number")throw new Error("Position values (x, y) must be numbers");if(typeof i!="number"||typeof o!="number"||i<=0||o<=0)throw new Error("Size values (width, height) must be positive numbers");if(typeof c!="string"||c.trim()==="")throw new Error("Name must be a non-empty string");if(figma.editorType!=="figma")throw new Error("Node creation is only available in Design mode");try{const I=figma.createRectangle();if(I.x=e,I.y=n,I.resize(i,o),I.name=Ne("Rectangle",c),f!==void 0)I.fills=f;else if(d)try{const k=F(d);I.fills=[k]}catch(k){throw new Error(`Invalid fill color: ${k.message}`)}if(t!==void 0)I.strokes=t;else if(s)try{const k=F(s);I.strokes=[k]}catch(k){throw new Error(`Invalid stroke color: ${k.message}`)}if(l!==void 0){if(typeof l!="number"||l<0)throw new Error("Stroke weight must be a non-negative number");I.strokeWeight=l}if(g!==void 0&&(I.strokeCap=g),u!==void 0&&(I.strokeJoin=u),w!==void 0&&(I.strokeAlign=w),p!==void 0&&(I.dashPattern=p),y!==void 0){if(typeof y!="number"||y<0||y>1)throw new Error("Opacity must be between 0 and 1");I.opacity=y}if(b!==void 0&&(I.blendMode=b),U!==void 0&&(I.visible=U),L!==void 0&&(I.locked=L),v!==void 0&&(I.isMask=v),C!==void 0&&(I.topLeftRadius=C),$!==void 0&&(I.topRightRadius=$),T!==void 0&&(I.bottomLeftRadius=T),O!==void 0&&(I.bottomRightRadius=O),B){const{topLeftRadius:k,topRightRadius:N,bottomRightRadius:V,bottomLeftRadius:q}=B;k!==void 0&&(I.topLeftRadius=k),N!==void 0&&(I.topRightRadius=N),V!==void 0&&(I.bottomRightRadius=V),q!==void 0&&(I.bottomLeftRadius=q)}if(E!==void 0){if(typeof E!="number"||E<0)throw new Error("Corner radius must be a non-negative number");I.cornerRadius=E}if(z!==void 0){if(typeof z!="number")throw new Error("Rotation must be a number (in degrees)");const k=z*Math.PI/180;I.rotation=k}if(H!==void 0&&(I.relativeTransform=H),X!==void 0)I.effects=X;else{let k=[...I.effects];if(P&&Array.isArray(P)){for(const N of P)if(N.type==="DROP_SHADOW"||N.type==="INNER_SHADOW"){const V={type:N.type,color:N.color||{r:0,g:0,b:0,a:.25},offset:N.offset||{x:0,y:4},radius:N.radius||4,spread:N.spread||0,visible:N.visible!==!1,blendMode:N.blendMode||"NORMAL"};k.push(V)}}if(D&&Array.isArray(D)){for(const N of D)if(N.type==="LAYER_BLUR"||N.type==="BACKGROUND_BLUR"){const V={type:N.type,radius:N.radius||4,visible:N.visible!==!1};k.push(V)}}(P||D)&&(I.effects=k)}G!==void 0&&(I.constraints=G),W!==void 0&&(I.clipsContent=W),x!==void 0&&(I.exportSettings=x),re!==void 0&&(I.relaunch=re),ne!==void 0&&(I.reactions=ne);const Q=await xe(I,a);return{nodeId:I.id,id:I.id,name:I.name,type:I.type,x:I.x,y:I.y,width:I.width,height:I.height,parentId:Q,success:!0,message:`Rectangle "${I.name}" created successfully`}}catch(I){throw new Error(`Failed to create rectangle: ${I.message}`)}}async function Xe(r){const{x:e=0,y:n=0,width:i=200,height:o=200,name:c=`Frame_${Date.now()}`,parentId:a,fills:f,fillColor:d,strokes:t,strokeColor:s,strokeWeight:l,strokeCap:g,strokeJoin:u,strokeAlign:w,dashPattern:p,opacity:y,blendMode:b,cornerRadius:E,topLeftRadius:C,topRightRadius:$,bottomLeftRadius:T,bottomRightRadius:O,individualCornerRadius:B,rotation:z,visible:U,locked:L,effects:X,shadows:P,blurs:D,constraints:G,relativeTransform:H,clipsContent:W,guides:Y,layoutMode:j,primaryAxisSizingMode:se,counterAxisSizingMode:v,primaryAxisAlignItems:R,counterAxisAlignItems:x,paddingLeft:Z,paddingRight:oe,paddingTop:le,paddingBottom:fe,itemSpacing:ge,counterAxisSpacing:re,layoutWrap:ne,strokesIncludedInLayout:ie,layoutGrids:I,gridStyleId:Q,isMask:k,maskType:N,exportSettings:V,overflowDirection:q,numberOfFixedChildren:ee,overlayPositionType:pe,overlayBackground:ye,overlayBackgroundInteraction:we,relaunch:de,reactions:ce,componentPropertyReferences:Ie}=r||{};if(typeof e!="number"||typeof n!="number")throw new Error("Position values (x, y) must be numbers");if(typeof i!="number"||typeof o!="number"||i<=0||o<=0)throw new Error("Size values (width, height) must be positive numbers");if(typeof c!="string"||c.trim()==="")throw new Error("Name must be a non-empty string");if(l!==void 0&&(typeof l!="number"||l<0))throw new Error("Stroke weight must be a non-negative number");if(figma.editorType!=="figma")throw new Error("Node creation is only available in Design mode");try{const h=figma.createFrame();if(h.x=e,h.y=n,h.resize(i,o),h.name=Ne("Frame",c),f!==void 0)h.fills=f;else if(d)try{const M=F(d);h.fills=[M]}catch(M){throw new Error(`Invalid fill color: ${M.message}`)}if(t!==void 0)h.strokes=t;else if(s)try{const M=F(s);h.strokes=[M]}catch(M){throw new Error(`Invalid stroke color: ${M.message}`)}if(l!==void 0){if(typeof l!="number"||l<0)throw new Error("Stroke weight must be a non-negative number");h.strokeWeight=l}if(g!==void 0&&(h.strokeCap=g),u!==void 0&&(h.strokeJoin=u),w!==void 0&&(h.strokeAlign=w),p!==void 0&&(h.dashPattern=p),y!==void 0){if(typeof y!="number"||y<0||y>1)throw new Error("Opacity must be between 0 and 1");h.opacity=y}if(b!==void 0&&(h.blendMode=b),U!==void 0&&(h.visible=U),L!==void 0&&(h.locked=L),k!==void 0&&(h.isMask=k),W!==void 0&&(h.clipsContent=W),C!==void 0&&(h.topLeftRadius=C),$!==void 0&&(h.topRightRadius=$),T!==void 0&&(h.bottomLeftRadius=T),O!==void 0&&(h.bottomRightRadius=O),B){const{topLeftRadius:M,topRightRadius:S,bottomRightRadius:te,bottomLeftRadius:ve}=B;M!==void 0&&(h.topLeftRadius=M),S!==void 0&&(h.topRightRadius=S),te!==void 0&&(h.bottomRightRadius=te),ve!==void 0&&(h.bottomLeftRadius=ve)}if(E!==void 0){if(typeof E!="number"||E<0)throw new Error("Corner radius must be a non-negative number");h.cornerRadius=E}if(z!==void 0){if(typeof z!="number")throw new Error("Rotation must be a number (in degrees)");const M=z*Math.PI/180;h.rotation=M}if(H!==void 0&&(h.relativeTransform=H),X!==void 0)h.effects=X;else{let M=[...h.effects];if(P&&Array.isArray(P)){for(const S of P)if(S.type==="DROP_SHADOW"||S.type==="INNER_SHADOW"){const te={type:S.type,color:S.color||{r:0,g:0,b:0,a:.25},offset:S.offset||{x:0,y:4},radius:S.radius||4,spread:S.spread||0,visible:S.visible!==!1,blendMode:S.blendMode||"NORMAL"};M.push(te)}}if(D&&Array.isArray(D)){for(const S of D)if(S.type==="LAYER_BLUR"||S.type==="BACKGROUND_BLUR"){const te={type:S.type,radius:S.radius||4,visible:S.visible!==!1};M.push(te)}}(P||D)&&(h.effects=M)}G!==void 0&&(h.constraints=G),j!==void 0&&(h.layoutMode=j),se!==void 0&&(h.primaryAxisSizingMode=se),v!==void 0&&(h.counterAxisSizingMode=v),R!==void 0&&(h.primaryAxisAlignItems=R),x!==void 0&&(h.counterAxisAlignItems=x),Z!==void 0&&(h.paddingLeft=Z),oe!==void 0&&(h.paddingRight=oe),le!==void 0&&(h.paddingTop=le),fe!==void 0&&(h.paddingBottom=fe),ge!==void 0&&(h.itemSpacing=ge),re!==void 0&&(h.counterAxisSpacing=re),ne!==void 0&&(h.layoutWrap=ne),ie!==void 0&&(h.strokesIncludedInLayout=ie),I!==void 0&&(h.layoutGrids=I),Q!==void 0&&(h.gridStyleId=Q),Y!==void 0&&(h.guides=Y),V!==void 0&&(h.exportSettings=V),de!==void 0&&(h.relaunch=de),ce!==void 0&&(h.reactions=ce);const ue=await xe(h,a);return{nodeId:h.id,id:h.id,name:h.name,type:h.type,x:h.x,y:h.y,width:h.width,height:h.height,fills:h.fills,strokes:h.strokes,strokeWeight:h.strokeWeight,parentId:ue,success:!0,message:`Frame "${h.name}" created successfully`}}catch(h){throw new Error(`Failed to create frame: ${h.message}`)}}async function Ke(r){const{x:e=0,y:n=0,text:i="Text",fontSize:o=14,fontWeight:c=400,fontColor:a,fontColorR:f,fontColorG:d,fontColorB:t,fontColorA:s,strokeColorR:l,strokeColorG:g,strokeColorB:u,strokeColorA:w,name:p="",parentId:y,fills:b,strokes:E,strokeColor:C,strokeWeight:$,strokeCap:T,strokeJoin:O,strokeAlign:B,strokeMiterLimit:z,dashPattern:U,opacity:L,blendMode:X,visible:P,locked:D,effects:G,shadows:H,blurs:W,constraints:Y,relativeTransform:j,clipsContent:se,guides:v,selection:R,isMask:x,maskType:Z,exportSettings:oe,overflowDirection:le,numberOfFixedChildren:fe,overlayPositionType:ge,overlayBackground:re,overlayBackgroundInteraction:ne,relaunch:ie,reactions:I,componentPropertyReferences:Q,characters:k,textCase:N,textDecoration:V,letterSpacing:q,lineHeight:ee,paragraphIndent:pe,paragraphSpacing:ye,textAutoResize:we,textAlignHorizontal:de,textAlignVertical:ce,fontName:Ie,textStyleId:h,fillStyleId:ue,strokeStyleId:M,effectStyleId:S,gridStyleId:te,backgroundStyleId:ve,hyperlink:Ce,textTruncation:ke,maxLines:Se,autoRename:Me,rotation:be}=r||{};if(typeof e!="number"||typeof n!="number")throw new Error("Position values (x, y) must be numbers");const Ee=k||i;if(typeof Ee!="string")throw new Error("Text content must be a string");if(typeof o!="number"||o<=0||o>200)throw new Error("Font size must be a positive number between 1 and 200");if(figma.editorType!=="figma")throw new Error("Node creation is only available in Design mode");try{const m=figma.createText();m.x=e,m.y=n,m.name=Ne("Text",p||Ee);let K=Ie;console.log("🔍 폰트 파라미터 디버깅:",{fontName:Ie,initialFontToUse:K}),K||(K={family:"Inter",style:"Regular"},console.log("⚠️ 기본 폰트 사용:",K)),console.log("🎯 최종 사용할 폰트:",K);try{await figma.loadFontAsync(K),m.fontName=K}catch(_){console.warn(`Requested font "${K.family}" not available, trying fallbacks`);const A=[{family:"Noto Sans KR",style:"Regular"},{family:"Inter",style:"Regular"},{family:"Roboto",style:"Regular"}];let ae=!1;for(const he of A)try{await figma.loadFontAsync(he),m.fontName=he,console.log(`✅ 폰트 로드 성공: ${he.family}`),ae=!0;break}catch(oo){console.warn(`❌ 폰트 로드 실패: ${he.family}`);continue}if(!ae)throw new Error("Unable to load any compatible font. Please ensure Noto Sans KR, Inter, or Roboto fonts are available.")}if(m.fontSize=o,m.characters=Ee,N!==void 0&&(m.textCase=N),V!==void 0&&(m.textDecoration=V),q!==void 0&&(typeof q=="number"?m.letterSpacing={value:q,unit:"PIXELS"}:typeof q=="object"&&q.value!==void 0?m.letterSpacing=q:console.warn("Invalid letterSpacing format, skipping...")),ee!==void 0&&(typeof ee=="number"?m.lineHeight={value:ee,unit:"PIXELS"}:typeof ee=="object"&&ee.value!==void 0?m.lineHeight=ee:console.warn("Invalid lineHeight format, skipping...")),pe!==void 0&&(m.paragraphIndent=pe),ye!==void 0&&(m.paragraphSpacing=ye),we!==void 0&&(m.textAutoResize=we),de!==void 0&&(m.textAlignHorizontal=de),ce!==void 0&&(m.textAlignVertical=ce),ke!==void 0&&(m.textTruncation=ke),Se!==void 0&&(m.maxLines=Se),Me!==void 0&&(m.autoRename=Me),Ce!==void 0&&(m.hyperlink=Ce),h!==void 0&&(m.textStyleId=h),ue!==void 0&&(m.fillStyleId=ue),M!==void 0&&(m.strokeStyleId=M),S!==void 0&&(m.effectStyleId=S),b)m.fills=b;else if(a)try{const _=F(a);m.fills=[_]}catch(_){throw new Error(`Invalid font color: ${_.message}`)}else if(f!==void 0||d!==void 0||t!==void 0||s!==void 0){const _={r:f||0,g:d||0,b:t||0,a:s!==void 0?s:1};try{const A=F(_);m.fills=[A]}catch(A){throw new Error(`Invalid font color: ${A.message}`)}}if(E)m.strokes=E;else if(C)try{const _=F(C);m.strokes=[_]}catch(_){throw new Error(`Invalid stroke color: ${_.message}`)}else if(l!==void 0||g!==void 0||u!==void 0||w!==void 0){const _={r:l||0,g:g||0,b:u||0,a:w!==void 0?w:1};try{const A=F(_);m.strokes=[A]}catch(A){throw new Error(`Invalid stroke color: ${A.message}`)}}if($!==void 0&&(m.strokeWeight=$),T!==void 0&&(m.strokeCap=T),O!==void 0&&(m.strokeJoin=O),B!==void 0&&(m.strokeAlign=B),z!==void 0&&(m.strokeMiterLimit=z),U!==void 0&&(m.dashPattern=U),L!==void 0){if(typeof L!="number"||L<0||L>1)throw new Error("Opacity must be between 0 and 1");m.opacity=L}if(X!==void 0&&(m.blendMode=X),P!==void 0&&(m.visible=P),D!==void 0&&(m.locked=D),x!==void 0&&(m.isMask=x),Z!==void 0&&(m.maskType=Z),be!==void 0){if(typeof be!="number")throw new Error("Rotation must be a number (in degrees)");const _=be*Math.PI/180;m.rotation=_}if(j!==void 0&&(m.relativeTransform=j),Y!==void 0&&(m.constraints=Y),G)m.effects=G;else{const _=[];if(H&&Array.isArray(H)){for(const A of H)if(A.type==="DROP_SHADOW"||A.type==="INNER_SHADOW"){const ae={type:A.type,color:A.color||{r:0,g:0,b:0,a:.25},offset:A.offset||{x:0,y:4},radius:A.radius||4,spread:A.spread||0,visible:A.visible!==!1,blendMode:A.blendMode||"NORMAL"};_.push(ae)}}if(W&&Array.isArray(W)){for(const A of W)if(A.type==="LAYER_BLUR"||A.type==="BACKGROUND_BLUR"){const ae={type:A.type,radius:A.radius||4,visible:A.visible!==!1};_.push(ae)}}_.length>0&&(m.effects=_)}oe!==void 0&&(m.exportSettings=oe),Q!==void 0&&(m.componentPropertyReferences=Q),ie!==void 0&&(m.relaunch=ie),I!==void 0&&(m.reactions=I);const Le=await xe(m,y);return{nodeId:m.id,id:m.id,name:m.name,type:m.type,x:m.x,y:m.y,width:m.width,height:m.height,characters:m.characters,fontSize:m.fontSize,fontName:m.fontName,parentId:Le,success:!0,message:`Text "${m.name}" created successfully`}}catch(m){throw new Error(`Failed to create text: ${m.message}`)}}async function Ye(r){if(!r||!r.nodeId)throw new Error("Missing required parameter: nodeId");console.log("setFillColor received params:",JSON.stringify(r,null,2));const{nodeId:e,color:n,gradient:i,Fill_Type:o,Start_Color:c,End_Color:a,Angle:f}=r;let d=i,t=n;if(o&&o!=="solid"?(d={type:o.toUpperCase(),startColor:c||"#FF0000",endColor:a||"#0000FF",angle:f||0},console.log("Converted n8n parameters to gradient:",JSON.stringify(d,null,2))):o==="solid"&&!n&&(t=r.color),!t&&!d)throw new Error("Missing required parameter: color or gradient");try{const s=await figma.getNodeByIdAsync(e);if(!s)throw new Error(`Node not found with ID: ${e}`);if(!("fills"in s))throw new Error(`Node type "${s.type}" does not support fill colors`);let l,g;if(d)l=Ge(d),g="gradient";else{if(typeof t=="string"){const u=Re(t);l=F(u)}else l=F(t);g="solid"}return s.fills=[l],{nodeId:s.id,id:s.id,name:s.name,type:s.type,fills:[l],fillType:g,success:!0,message:`Fill ${g} applied to "${s.name}" successfully`}}catch(s){throw new Error(`Failed to set fill color: ${s.message}`)}}async function je(r){const{nodeId:e,color:{r:n,g:i,b:o,a:c},weight:a=1,removeStroke:f=!1}=r||{},d=r.color||{r:r.Stroke_Red_Value||n||1,g:r.Stroke_Green_Value||i||0,b:r.Stroke_Blue_Value||o||0,a:r.Stroke_Alpha_Value||c||1};if(!e)throw new Error("Missing nodeId parameter");const t=await figma.getNodeByIdAsync(e);if(!t)throw new Error(`Node not found with ID: ${e}`);if(!("strokes"in t))throw new Error(`Node does not support strokes: ${e}`);if(f)return t.strokes=[],"strokeWeight"in t&&(t.strokeWeight=0),{nodeId:t.id,id:t.id,name:t.name,strokes:t.strokes,strokeWeight:"strokeWeight"in t?t.strokeWeight:void 0,removed:!0};const s={type:"SOLID",color:{r:parseFloat(d.r)||0,g:parseFloat(d.g)||0,b:parseFloat(d.b)||0},opacity:parseFloat(d.a)||1};return t.strokes=[s],"strokeWeight"in t&&(t.strokeWeight=a),{nodeId:t.id,id:t.id,name:t.name,strokes:t.strokes,strokeWeight:"strokeWeight"in t?t.strokeWeight:void 0,removed:!1}}async function Qe(r){const{nodeId:e,x:n,y:i}=r||{};if(!e)throw new Error("Missing nodeId parameter");if(n===void 0||i===void 0)throw new Error("Missing x or y parameters");const o=await figma.getNodeByIdAsync(e);if(!o)throw new Error(`Node not found with ID: ${e}`);if(!("x"in o)||!("y"in o))throw new Error(`Node does not support position: ${e}`);return o.x=n,o.y=i,{nodeId:o.id,id:o.id,name:o.name,x:o.x,y:o.y}}async function et(r){const{nodeId:e,width:n,height:i}=r||{};if(!e)throw new Error("Missing nodeId parameter");if(n===void 0||i===void 0)throw new Error("Missing width or height parameters");const o=await figma.getNodeByIdAsync(e);if(!o)throw new Error(`Node not found with ID: ${e}`);if(!("resize"in o))throw new Error(`Node does not support resizing: ${e}`);return o.resize(n,i),{nodeId:o.id,id:o.id,name:o.name,width:o.width,height:o.height}}async function tt(r){const{nodeId:e}=r||{};if(!e)throw new Error("Missing nodeId parameter");const n=await figma.getNodeByIdAsync(e);if(!n)throw new Error(`Node not found with ID: ${e}`);const i={nodeId:n.id,id:n.id,name:n.name,type:n.type};return n.remove(),i}async function ot(r){const{nodeId:e,x:n,y:i}=r||{};if(!e)throw new Error("Missing nodeId parameter");const o=await figma.getNodeByIdAsync(e);if(!o)throw new Error(`Node not found with ID: ${e}`);const c=o.clone();if(n!==void 0&&i!==void 0){if(!("x"in c)||!("y"in c))throw new Error(`Cloned node does not support position: ${e}`);c.x=n,c.y=i}return o.parent?o.parent.appendChild(c):figma.currentPage.appendChild(c),{nodeId:c.id,id:c.id,name:c.name,x:"x"in c?c.x:void 0,y:"y"in c?c.y:void 0,width:"width"in c?c.width:void 0,height:"height"in c?c.height:void 0}}async function rt(r){const{nodeId:e,scale:n=1,format:i="PNG"}=r||{};if(!e)throw new Error("Missing nodeId parameter");const o=await figma.getNodeByIdAsync(e);if(!o)throw new Error(`Node not found with ID: ${e}`);if(!("exportAsync"in o))throw new Error(`Node does not support exporting: ${e}`);try{const c={format:i,constraint:{type:"SCALE",value:n}},a=await o.exportAsync(c),f=nt(a);return{nodeId:e,format:i,scale:n,imageData:f}}catch(c){throw new Error(`Error exporting node as image: ${c.message}`)}}function nt(r){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";let n="";const i=r.byteLength,o=i%3,c=i-o;let a,f,d,t,s;for(let l=0;l<c;l=l+3)s=r[l]<<16|r[l+1]<<8|r[l+2],a=(s&16515072)>>18,f=(s&258048)>>12,d=(s&4032)>>6,t=s&63,n+=e[a]+e[f]+e[d]+e[t];return o===1?(s=r[c],a=(s&252)>>2,f=(s&3)<<4,n+=e[a]+e[f]+"=="):o===2&&(s=r[c]<<8|r[c+1],a=(s&64512)>>10,f=(s&1008)>>4,d=(s&15)<<2,n+=e[a]+e[f]+e[d]+"="),n}async function it(r){const{nodeIds:e}=r||{};if(!e||!Array.isArray(e))throw new Error("Missing or invalid nodeIds parameter");const n=[];for(const i of e)try{const o=await figma.getNodeByIdAsync(i);o&&n.push({nodeId:o.id,id:o.id,name:o.name,type:o.type,visible:o.visible,locked:o.locked,x:"x"in o?o.x:void 0,y:"y"in o?o.y:void 0,width:"width"in o?o.width:void 0,height:"height"in o?o.height:void 0,fills:"fills"in o?o.fills:void 0,strokes:"strokes"in o?o.strokes:void 0})}catch(o){n.push({nodeId:i,id:i,error:o.message})}return{nodes:n}}async function at(r){const{nodeId:e,text:n}=r||{};if(!e)throw new Error("Missing nodeId parameter");if(!n)throw new Error("Missing text parameter");const i=await figma.getNodeByIdAsync(e);if(!i)throw new Error(`Node not found with ID: ${e}`);if(i.type!=="TEXT")throw new Error(`Node is not a text node: ${e}`);try{await figma.loadFontAsync(i.fontName),i.characters=n}catch(o){throw new Error(`Error setting text content: ${o.message}`)}return{nodeId:i.id,id:i.id,name:i.name,characters:i.characters}}async function st(){return{paintStyles:(await figma.getLocalPaintStylesAsync()).map(r=>({nodeId:r.id,id:r.id,name:r.name,type:r.type,paints:r.paints})),textStyles:(await figma.getLocalTextStylesAsync()).map(r=>({nodeId:r.id,id:r.id,name:r.name,type:r.type,fontSize:r.fontSize,fontName:r.fontName})),effectStyles:(await figma.getLocalEffectStylesAsync()).map(r=>({nodeId:r.id,id:r.id,name:r.name,type:r.type,effects:r.effects}))}}async function dt(r){try{const e=(r==null?void 0:r.keyword)||"";console.log(`🔍 사용 가능한 폰트 검색 중... (키워드: "${e}")`);const n=await figma.listAvailableFontsAsync();console.log(`✅ 총 ${n.length}개의 폰트 발견`);let i=n.map(a=>{var f,d;return{family:((f=a.fontName)==null?void 0:f.family)||"Unknown",style:((d=a.fontName)==null?void 0:d.style)||"Regular",postScriptName:a.fontPostScriptName||"Unknown"}});if(e&&e.trim()!==""){const a=e.toLowerCase().trim();i=i.filter(f=>f.family&&f.family.toLowerCase().includes(a)||f.style&&f.style.toLowerCase().includes(a)||f.postScriptName&&f.postScriptName.toLowerCase().includes(a)),console.log(`🎯 키워드 "${e}"로 필터링된 폰트: ${i.length}개`)}const o={};i.forEach(a=>{o[a.family]||(o[a.family]=[]),o[a.family].push({style:a.style,postScriptName:a.postScriptName})});const c={totalFonts:i.length,totalFamilies:Object.keys(o).length,families:Object.keys(o).sort(),searchKeyword:e,isFiltered:e&&e.trim()!==""};return{success:!0,fonts:i,fontFamilies:o,stats:c,timestamp:new Date().toISOString()}}catch(e){throw console.error("❌ 폰트 검색 실패:",e),new Error(`Failed to search available fonts: ${e.message}`)}}async function ct(){return{components:(await figma.getLocalComponentsAsync()).map(r=>({nodeId:r.id,id:r.id,name:r.name,type:r.type,key:r.key,description:r.description}))}}async function lt(r){const{componentKey:e,x:n=0,y:i=0,name:o,parentId:c}=r||{};if(!e)throw new Error("Missing componentKey parameter");if(figma.editorType!=="figma")throw new Error("Node creation is only available in Design mode");const f=(await figma.getLocalComponentsAsync()).find(s=>s.key===e);if(!f)throw new Error(`Component not found with key: ${e}`);const d=f.createInstance();d.x=n,d.y=i,o&&(d.name=o);let t=figma.currentPage;if(c)try{const s=await figma.getNodeByIdAsync(c);s&&"appendChild"in s?t=s:console.warn(`Parent node with ID ${c} not found or cannot contain children. Using current page.`)}catch(s){console.warn(`Error finding parent node ${c}:`,s.message,"Using current page.")}return t.appendChild(d),{nodeId:d.id,id:d.id,name:d.name,x:d.x,y:d.y,componentKey:e,mainComponentId:f.id}}async function ft(r){const{nodeId:e,cornerRadius:n}=r||{};if(!e)throw new Error("Missing nodeId parameter");if(n===void 0)throw new Error("Missing cornerRadius parameter");const i=await figma.getNodeByIdAsync(e);if(!i)throw new Error(`Node not found with ID: ${e}`);if(!("cornerRadius"in i))throw new Error(`Node does not support corner radius: ${e}`);return i.cornerRadius=n,{nodeId:i.id,id:i.id,name:i.name,cornerRadius:i.cornerRadius,success:!0,message:`Corner radius set to ${n} for "${i.name}"`}}async function gt(r){const{nodeId:e,opacity:n}=r||{};if(!e)throw new Error("Missing nodeId parameter");if(n===void 0||typeof n!="number")throw new Error("Missing or invalid opacity parameter (must be a number between 0 and 1)");if(n<0||n>1)throw new Error("Opacity must be between 0 and 1");const i=await figma.getNodeByIdAsync(e);if(!i)throw new Error(`Node not found with ID: ${e}`);if(!("opacity"in i))throw new Error(`Node does not support opacity: ${e}`);return i.opacity=n,{nodeId:i.id,id:i.id,name:i.name,opacity:i.opacity,success:!0,message:`Opacity set to ${n} for "${i.name}"`}}async function ut(r){const{nodeId:e,rotation:n}=r||{};if(!e)throw new Error("Missing nodeId parameter");if(n===void 0||typeof n!="number")throw new Error("Missing or invalid rotation parameter (must be a number in degrees)");const i=await figma.getNodeByIdAsync(e);if(!i)throw new Error(`Node not found with ID: ${e}`);if(!("rotation"in i))throw new Error(`Node does not support rotation: ${e}`);const o=n*Math.PI/180;return i.rotation=o,{nodeId:i.id,id:i.id,name:i.name,rotation:n,rotationRadians:i.rotation,success:!0,message:`Rotation set to ${n}° for "${i.name}"`}}async function ht(r){const{nodeId:e,offsetX:n=0,offsetY:i=4,blur:o=4,spread:c=0,color:a={r:0,g:0,b:0,a:.25},visible:f=!0}=r||{};if(!e)throw new Error("Missing nodeId parameter");const d=await figma.getNodeByIdAsync(e);if(!d)throw new Error(`Node not found with ID: ${e}`);if(!("effects"in d))throw new Error(`Node does not support effects: ${e}`);const t=F(a),s={type:"DROP_SHADOW",visible:f,color:t.color,blendMode:"NORMAL",offset:{x:n,y:i},radius:o,spread:c},l=d.effects||[];return d.effects=[...l,s],{nodeId:d.id,id:d.id,name:d.name,effects:d.effects,success:!0,message:`Drop shadow added to "${d.name}"`}}async function mt(r){const{nodeId:e,offsetX:n=0,offsetY:i=4,blur:o=4,spread:c=0,color:a={r:0,g:0,b:0,a:.25},visible:f=!0}=r||{};if(!e)throw new Error("Missing nodeId parameter");const d=await figma.getNodeByIdAsync(e);if(!d)throw new Error(`Node not found with ID: ${e}`);if(!("effects"in d))throw new Error(`Node does not support effects: ${e}`);const t=F(a),s={type:"INNER_SHADOW",visible:f,color:t.color,blendMode:"NORMAL",offset:{x:n,y:i},radius:o,spread:c},l=d.effects||[];return d.effects=[...l,s],{nodeId:d.id,id:d.id,name:d.name,effects:d.effects,success:!0,message:`Inner shadow added to "${d.name}"`}}async function pt(r){const{nodeId:e,radius:n=4,type:i="LAYER_BLUR",visible:o=!0}=r||{};if(!e)throw new Error("Missing nodeId parameter");if(typeof n!="number"||n<0)throw new Error("Radius must be a positive number");if(!["LAYER_BLUR","BACKGROUND_BLUR"].includes(i))throw new Error('Blur type must be either "LAYER_BLUR" or "BACKGROUND_BLUR"');const c=await figma.getNodeByIdAsync(e);if(!c)throw new Error(`Node not found with ID: ${e}`);if(!("effects"in c))throw new Error(`Node does not support effects: ${e}`);const a={type:i,visible:o,radius:n},f=c.effects||[];return c.effects=[...f,a],{nodeId:c.id,id:c.id,name:c.name,effects:c.effects,success:!0,message:`${i.toLowerCase().replace("_"," ")} effect (radius: ${n}) added to "${c.name}"`}}async function yt(r){const{nodeId:e,topLeft:n,topRight:i,bottomLeft:o,bottomRight:c}=r||{};if(!e)throw new Error("Missing nodeId parameter");if(n===void 0&&i===void 0&&o===void 0&&c===void 0)throw new Error("At least one corner radius value must be provided");const a=await figma.getNodeByIdAsync(e);if(!a)throw new Error(`Node not found with ID: ${e}`);if(!("topLeftRadius"in a))throw new Error(`Node does not support individual corner radius: ${e}`);if(n!==void 0){if(typeof n!="number"||n<0)throw new Error("topLeft radius must be a non-negative number");a.topLeftRadius=n}if(i!==void 0){if(typeof i!="number"||i<0)throw new Error("topRight radius must be a non-negative number");a.topRightRadius=i}if(o!==void 0){if(typeof o!="number"||o<0)throw new Error("bottomLeft radius must be a non-negative number");a.bottomLeftRadius=o}if(c!==void 0){if(typeof c!="number"||c<0)throw new Error("bottomRight radius must be a non-negative number");a.bottomRightRadius=c}return{nodeId:a.id,id:a.id,name:a.name,cornerRadii:{topLeft:a.topLeftRadius,topRight:a.topRightRadius,bottomLeft:a.bottomLeftRadius,bottomRight:a.bottomRightRadius},success:!0,message:`Individual corner radii set for "${a.name}"`}}async function wt(r){const{nodeId:e}=r||{};let n;if(e){if(n=await figma.getNodeByIdAsync(e),!n)throw new Error(`Node not found with ID: ${e}`)}else n=figma.currentPage;const i=[];function o(c){if(c.type==="TEXT"&&i.push({nodeId:c.id,id:c.id,name:c.name,characters:c.characters,fontSize:c.fontSize,fontName:c.fontName,x:c.x,y:c.y}),"children"in c)for(const a of c.children)o(a)}return o(n),{textNodes:i}}async function It(r){const{nodeTypes:e,nodeId:n}=r||{};if(!e||!Array.isArray(e))throw new Error("Missing or invalid nodeTypes parameter");let i;if(n){if(i=await figma.getNodeByIdAsync(n),!i)throw new Error(`Node not found with ID: ${n}`)}else i=figma.currentPage;const o=[];function c(a){if(e.includes(a.type)&&o.push({nodeId:a.id,id:a.id,name:a.name,type:a.type,x:"x"in a?a.x:void 0,y:"y"in a?a.y:void 0,width:"width"in a?a.width:void 0,height:"height"in a?a.height:void 0}),"children"in a)for(const f of a.children)c(f)}return c(i),{nodes:o}}async function vt(r){const{updates:e}=r||{};if(!e||!Array.isArray(e))throw new Error("Missing or invalid updates parameter");const n=[];for(const i of e)try{const{nodeId:o,text:c}=i;if(!o||!c){n.push({nodeId:o||"unknown",success:!1,error:"Missing nodeId or text"});continue}const a=await figma.getNodeByIdAsync(o);if(!a){n.push({nodeId:o,success:!1,error:"Node not found"});continue}if(a.type!=="TEXT"){n.push({nodeId:o,success:!1,error:"Node is not a text node"});continue}await figma.loadFontAsync(a.fontName),a.characters=c,n.push({nodeId:o,success:!0,name:a.name,characters:a.characters})}catch(o){n.push({nodeId:i.nodeId||"unknown",success:!1,error:o.message})}return{results:n}}async function bt(r){const{nodeIds:e}=r||{};if(!e||!Array.isArray(e))throw new Error("Missing or invalid nodeIds parameter");const n=[];for(const i of e)try{const o=await figma.getNodeByIdAsync(i);if(!o){n.push({nodeId:i,success:!1,error:"Node not found"});continue}const c={nodeId:o.id,id:o.id,name:o.name,type:o.type};o.remove(),n.push(me({nodeId:i,success:!0},c))}catch(o){n.push({nodeId:i,success:!1,error:o.message})}return{results:n}}async function Et(r){const{nodeId:e,layoutMode:n}=r||{};if(!e)throw new Error("Missing nodeId parameter");if(!n)throw new Error("Missing layoutMode parameter");const i=await figma.getNodeByIdAsync(e);if(!i)throw new Error(`Node not found with ID: ${e}`);if(!("layoutMode"in i))throw new Error(`Node does not support layout mode: ${e}`);return i.layoutMode=n,{id:i.id,name:i.name,layoutMode:i.layoutMode}}async function At(r){const{nodeId:e,paddingTop:n=0,paddingRight:i=0,paddingBottom:o=0,paddingLeft:c=0}=r||{};if(!e)throw new Error("Missing nodeId parameter");const a=await figma.getNodeByIdAsync(e);if(!a)throw new Error(`Node not found with ID: ${e}`);if(!("paddingTop"in a))throw new Error(`Node does not support padding: ${e}`);return a.paddingTop=n,a.paddingRight=i,a.paddingBottom=o,a.paddingLeft=c,{id:a.id,name:a.name,paddingTop:a.paddingTop,paddingRight:a.paddingRight,paddingBottom:a.paddingBottom,paddingLeft:a.paddingLeft}}async function Rt(r){const{nodeId:e,primaryAxisAlignItems:n,counterAxisAlignItems:i}=r||{};if(!e)throw new Error("Missing nodeId parameter");const o=await figma.getNodeByIdAsync(e);if(!o)throw new Error(`Node not found with ID: ${e}`);if(!("primaryAxisAlignItems"in o))throw new Error(`Node does not support axis alignment: ${e}`);return n&&(o.primaryAxisAlignItems=n),i&&(o.counterAxisAlignItems=i),{id:o.id,name:o.name,primaryAxisAlignItems:o.primaryAxisAlignItems,counterAxisAlignItems:o.counterAxisAlignItems}}async function xt(r){const{nodeId:e,horizontalSizing:n,verticalSizing:i}=r||{};if(!e)throw new Error("Missing nodeId parameter");const o=await figma.getNodeByIdAsync(e);if(!o)throw new Error(`Node not found with ID: ${e}`);if(!("layoutSizingHorizontal"in o))throw new Error(`Node does not support layout sizing: ${e}`);return n&&(o.layoutSizingHorizontal=n),i&&(o.layoutSizingVertical=i),{id:o.id,name:o.name,layoutSizingHorizontal:o.layoutSizingHorizontal,layoutSizingVertical:o.layoutSizingVertical}}async function Nt(r){const{nodeId:e,itemSpacing:n}=r||{};if(!e)throw new Error("Missing nodeId parameter");if(n===void 0)throw new Error("Missing itemSpacing parameter");const i=await figma.getNodeByIdAsync(e);if(!i)throw new Error(`Node not found with ID: ${e}`);if(!("itemSpacing"in i))throw new Error(`Node does not support item spacing: ${e}`);return i.itemSpacing=n,{id:i.id,name:i.name,itemSpacing:i.itemSpacing}}async function Ct(r){const{nodeId:e}=r||{};return{message:"Annotations API is limited in Figma plugins",nodeId:e||"current_page"}}async function kt(r){const{nodeId:e,text:n}=r||{};if(!e)throw new Error("Missing nodeId parameter");return{message:"Annotation setting is limited in Figma plugins",nodeId:e,text:n||""}}async function St(r){var o;const{sourceInstanceId:e}=r||{};if(!e)throw new Error("Missing sourceInstanceId parameter");const n=await figma.getNodeByIdAsync(e);if(!n)throw new Error(`Node not found with ID: ${e}`);if(n.type!=="INSTANCE")throw new Error(`Node is not a component instance: ${e}`);const i={};return{sourceInstanceId:e,mainComponentId:(o=n.mainComponent)==null?void 0:o.id,overridesCount:Object.keys(i).length,success:!0,message:"Instance overrides retrieved (limited by Figma API)"}}async function Mt(r){const{overrides:e}=r||{};if(!e)throw new Error("Missing overrides parameter");return{success:!0,message:"Instance overrides setting is limited in Figma plugins",totalCount:Object.keys(e).length}}async function _t(r){const{nodeIds:e}=r||{};if(!e||!Array.isArray(e))return{reactions:[],message:"No node IDs provided"};const n=[];for(const i of e)try{const o=await figma.getNodeByIdAsync(i);o&&"reactions"in o&&o.reactions&&n.push({nodeId:i,reactions:o.reactions.map(c=>({action:c.action,trigger:c.trigger}))})}catch(o){n.push({nodeId:i,error:o.message})}return{reactions:n}}async function $t(r){const{connectorId:e}=r||{};if(!e)throw new Error("Missing connectorId parameter");return{success:!0,connectorId:e,message:"Default connector setting is limited in Figma plugins"}}async function Pt(r){const{connections:e}=r||{};if(!e||!Array.isArray(e))throw new Error("Missing or invalid connections parameter");return{success:!0,connectionsCount:e.length,message:"Connection creation is limited in Figma plugins"}}async function Dt(r){const{url:e,base64Data:n,mimeType:i,x:o=0,y:c=0,width:a=200,height:f=200,name:d,parentId:t,scaleMode:s="FILL",cornerRadius:l=0}=r||{};if(!e&&!n)throw new Error("Either Image URL or Base64 data is required");if(figma.editorType!=="figma")throw new Error("Node creation is only available in Design mode");try{let g;if(n){console.log("Creating image from Base64 data, mimeType:",i);const b=atob(n),E=new Uint8Array(b.length);for(let C=0;C<b.length;C++)E[C]=b.charCodeAt(C);g=figma.createImage(E)}else console.log("Creating image from URL:",e),g=await figma.createImageAsync(e);if(!g)throw new Error("Failed to load image from URL - image may not be accessible or valid");console.log("Image created successfully, hash:",g.hash);const u=figma.createRectangle();u.x=o,u.y=c,u.resize(a,f),l>0&&(u.cornerRadius=l);const p=["FILL","FIT","CROP","TILE"].includes(s)?s:"FILL",y=[{type:"IMAGE",scaleMode:p,imageHash:g.hash}];if(u.fills=y,d?u.name=d:u.name=`Image from URL ${Date.now()}`,t)try{const b=await figma.getNodeByIdAsync(t);if(!b)throw new Error(`Parent node not found with ID: ${t}`);if(!("appendChild"in b))throw new Error(`Parent node does not support children: ${t}`);b.appendChild(u)}catch(b){console.warn("Failed to add to parent, adding to current page:",b.message),figma.currentPage.appendChild(u)}else figma.currentPage.appendChild(u);return figma.currentPage.selection=[u],figma.viewport.scrollAndZoomIntoView([u]),{nodeId:u.id,id:u.id,name:u.name,type:u.type,x:u.x,y:u.y,width:u.width,height:u.height,cornerRadius:u.cornerRadius,imageUrl:e||null,imageSource:n?"base64":"url",imageHash:g.hash,scaleMode:p,parentId:t||null,success:!0}}catch(g){console.error("Error creating image:",g);let u="Unknown error occurred";throw g&&g.message?u=g.message:typeof g=="string"?u=g:g&&(u=g.toString()),e&&(u.includes("fetch")||u.includes("CORS")||u.includes("network"))?u=`Image could not be loaded from URL. This may be due to CORS restrictions, invalid URL, or network issues. URL: ${e}`:n&&u.includes("Invalid")&&(u="Invalid Base64 image data provided. Please check the image format and data integrity."),new Error(`Failed to create image from URL: ${u}`)}}async function Lt(r){const{x:e=0,y:n=0,width:i=200,height:o=40,minValue:c=0,maxValue:a=100,currentValue:f=50,name:d="Slider",parentId:t}=r||{};if(figma.editorType!=="figma")throw new Error("Node creation is only available in Design mode");try{const s=figma.createFrame();s.name=d,s.x=e,s.y=n,s.resize(i,o),s.layoutMode="HORIZONTAL",s.primaryAxisAlignItems="CENTER",s.counterAxisAlignItems="CENTER",s.itemSpacing=12,s.paddingLeft=8,s.paddingRight=8,s.paddingTop=8,s.paddingBottom=8;const l=figma.createRectangle();l.name="Track",l.resize(i-80,4),l.cornerRadius=2,l.fills=[{type:"SOLID",color:{r:.9,g:.9,b:.9}}];const g=Math.max(8,(f-c)/(a-c)*(i-80)),u=figma.createRectangle();u.name="Progress",u.resize(g,4),u.cornerRadius=2,u.fills=[{type:"SOLID",color:{r:0,g:.5,b:1}}];const w=figma.createEllipse();w.name="Thumb",w.resize(16,16),w.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}],w.strokes=[{type:"SOLID",color:{r:.8,g:.8,b:.8}}],w.strokeWeight=1,w.x=u.width-8,w.y=-6;const p=figma.createText();await figma.loadFontAsync({family:"Inter",style:"Regular"}),p.name="Value",p.characters=f.toString(),p.fontSize=12,p.fills=[{type:"SOLID",color:{r:0,g:0,b:0}}];const y=figma.createFrame();if(y.name="Track Container",y.resize(i-80,16),y.fills=[],y.clipsContent=!1,y.appendChild(l),y.appendChild(u),y.appendChild(w),l.x=0,l.y=6,u.x=0,u.y=6,s.appendChild(y),s.appendChild(p),y.layoutSizingHorizontal="FILL",p.layoutSizingHorizontal="HUG",t)try{const b=await figma.getNodeByIdAsync(t);if(!b)throw new Error(`Parent node not found with ID: ${t}`);if(!("appendChild"in b))throw new Error(`Parent node does not support children: ${t}`);b.appendChild(s)}catch(b){console.warn("Failed to add to parent, adding to current page:",b.message),figma.currentPage.appendChild(s)}else figma.currentPage.appendChild(s);return figma.currentPage.selection=[s],figma.viewport.scrollAndZoomIntoView([s]),{nodeId:s.id,id:s.id,name:s.name,type:s.type,x:s.x,y:s.y,width:s.width,height:s.height,minValue:c,maxValue:a,currentValue:f,parentId:t||null,components:{container:s.id,trackContainer:y.id,track:l.id,progress:u.id,thumb:w.id,valueLabel:p.id},success:!0}}catch(s){throw console.error("Error creating slider:",s),new Error(`Failed to create slider: ${s.message||s}`)}}async function Ft(r){const{x:e=0,y:n=0,width:i=100,height:o=100,name:c="Ellipse",parentId:a,fills:f,fillColor:d,strokes:t,strokeColor:s,strokeWeight:l,strokeCap:g,strokeJoin:u,strokeAlign:w,dashPattern:p,opacity:y,blendMode:b,rotation:E,visible:C,locked:$,effects:T,shadows:O,blurs:B,constraints:z,relativeTransform:U,isMask:L,maskType:X,exportSettings:P,relaunch:D,reactions:G,componentPropertyReferences:H,arcData:W,startingAngle:Y,endingAngle:j,innerRadius:se}=r||{};if(figma.editorType!=="figma")throw new Error("Node creation is only available in Design mode");try{const v=figma.createEllipse();if(v.x=e,v.y=n,v.resize(i,o),v.name=c,f!==void 0)v.fills=f;else if(d)try{const R=F(d);v.fills=[R]}catch(R){throw new Error(`Invalid fill color: ${R.message}`)}if(t!==void 0)v.strokes=t;else if(s)try{const R=F(s);v.strokes=[R]}catch(R){throw new Error(`Invalid stroke color: ${R.message}`)}if(l!==void 0){if(typeof l!="number"||l<0)throw new Error("Stroke weight must be a non-negative number");v.strokeWeight=l}if(g!==void 0&&(v.strokeCap=g),u!==void 0&&(v.strokeJoin=u),w!==void 0&&(v.strokeAlign=w),p!==void 0&&(v.dashPattern=p),y!==void 0){if(typeof y!="number"||y<0||y>1)throw new Error("Opacity must be between 0 and 1");v.opacity=y}if(b!==void 0&&(v.blendMode=b),C!==void 0&&(v.visible=C),$!==void 0&&(v.locked=$),L!==void 0&&(v.isMask=L),E!==void 0){if(typeof E!="number")throw new Error("Rotation must be a number (in degrees)");const R=E*Math.PI/180;v.rotation=R}if(U!==void 0&&(v.relativeTransform=U),T!==void 0)v.effects=T;else{let R=[...v.effects];if(O&&Array.isArray(O)){for(const x of O)if(x.type==="DROP_SHADOW"||x.type==="INNER_SHADOW"){const Z={type:x.type,color:x.color||{r:0,g:0,b:0,a:.25},offset:x.offset||{x:0,y:4},radius:x.radius||4,spread:x.spread||0,visible:x.visible!==!1,blendMode:x.blendMode||"NORMAL"};R.push(Z)}}if(B&&Array.isArray(B)){for(const x of B)if(x.type==="LAYER_BLUR"||x.type==="BACKGROUND_BLUR"){const Z={type:x.type,radius:x.radius||4,visible:x.visible!==!1};R.push(Z)}}(O||B)&&(v.effects=R)}if(z!==void 0&&(v.constraints=z),P!==void 0&&(v.exportSettings=P),W!==void 0&&(v.arcData=W),D!==void 0&&(v.relaunch=D),G!==void 0&&(v.reactions=G),a)try{const R=await figma.getNodeByIdAsync(a);if(!R)throw new Error(`Parent node not found with ID: ${a}`);if(!("appendChild"in R))throw new Error(`Parent node does not support children: ${a}`);R.appendChild(v)}catch(R){console.warn("Failed to add to parent, adding to current page:",R.message),figma.currentPage.appendChild(v)}else figma.currentPage.appendChild(v);return figma.currentPage.selection=[v],figma.viewport.scrollAndZoomIntoView([v]),{nodeId:v.id,id:v.id,name:v.name,type:v.type,x:v.x,y:v.y,width:v.width,height:v.height,parentId:a||null,success:!0}}catch(v){throw console.error("Error creating ellipse:",v),new Error(`Failed to create ellipse: ${v.message||v}`)}}function Tt(r){let e=r;return e=Ot(e),e=zt(e),e=Vt(e),e}function Ot(r){return r.replace(/C\s*([\d.-]+)[,\s]+([\d.-]+)[,\s]+([\d.-]+)[,\s]+([\d.-]+)[,\s]+([\d.-]+)[,\s]+([\d.-]+)/g,(e,n,i,o,c,a,f,d,t)=>{const l=t.substring(0,d).match(/[ML]\s*([\d.-]+)[,\s]+([\d.-]+)(?!.*[ML])/g);let g=0,u=0;if(l&&l.length>0){const y=l[l.length-1].match(/([\d.-]+)/g);y&&y.length>=2&&(g=parseFloat(y[y.length-2]),u=parseFloat(y[y.length-1]))}return Bt(g,u,parseFloat(n),parseFloat(i),parseFloat(o),parseFloat(c),parseFloat(a),parseFloat(f))})}function Bt(r,e,n,i,o,c,a,f,d=8){let t="";for(let s=1;s<=d;s++){const l=s/d,g=Math.pow(1-l,3)*r+3*Math.pow(1-l,2)*l*n+3*(1-l)*Math.pow(l,2)*o+Math.pow(l,3)*a,u=Math.pow(1-l,3)*e+3*Math.pow(1-l,2)*l*i+3*(1-l)*Math.pow(l,2)*c+Math.pow(l,3)*f;t+=` L ${Math.round(g*100)/100} ${Math.round(u*100)/100}`}return t}function zt(r){return r.replace(/A\s*([\d.-]+)[,\s]+([\d.-]+)[,\s]+([\d.-]+)[,\s]+([01])[,\s]+([01])[,\s]+([\d.-]+)[,\s]+([\d.-]+)/g,(e,n,i,o,c,a,f,d,t,s)=>{const g=s.substring(0,t).match(/[ML]\s*([\d.-]+)[,\s]+([\d.-]+)(?!.*[ML])/g);let u=0,w=0;if(g&&g.length>0){const y=g[g.length-1].match(/([\d.-]+)/g);y&&y.length>=2&&(u=parseFloat(y[y.length-2]),w=parseFloat(y[y.length-1]))}return Wt(u,w,parseFloat(n),parseFloat(i),parseFloat(o),parseInt(c),parseInt(a),parseFloat(f),parseFloat(d))})}function Wt(r,e,n,i,o,c,a,f,d,t=12){let s="";const l=f-r,g=d-e,u=Math.sqrt(l*l+g*g);if(u===0)return` L ${f} ${d}`;for(let w=1;w<=t;w++){const p=w/t,y=-g*(n/u)*Math.sin(Math.PI*p)*.5,b=l*(i/u)*Math.sin(Math.PI*p)*.5,E=r+p*l+y,C=e+p*g+b;s+=` L ${Math.round(E*100)/100} ${Math.round(C*100)/100}`}return s}function Vt(r){return r.replace(/,\s*,/g,",").replace(/,(\s*[a-zA-Z])/g," $1").replace(/([a-zA-Z])\s*,/g,"$1 ").replace(/\s+/g," ").trim()}async function Ut(r){const{pathData:e,x:n=0,y:i=0,name:o="Vector Path",parentId:c}=r||{};if(figma.editorType!=="figma")throw new Error("Node creation is only available in Design mode");if(!e)throw new Error("SVG path data is required");try{const a=figma.createVector();a.name=o;const d=[{windingRule:"NONZERO",data:Tt(e)}];if(a.vectorPaths=d,a.x=n,a.y=i,c)try{const t=await figma.getNodeByIdAsync(c);if(!t)throw new Error(`Parent node not found with ID: ${c}`);if(!("appendChild"in t))throw new Error(`Parent node does not support children: ${c}`);t.appendChild(a)}catch(t){console.warn("Failed to add to parent, adding to current page:",t.message),figma.currentPage.appendChild(a)}else figma.currentPage.appendChild(a);return figma.currentPage.selection=[a],figma.viewport.scrollAndZoomIntoView([a]),{nodeId:a.id,id:a.id,name:a.name,type:a.type,x:a.x,y:a.y,width:a.width,height:a.height,pathData:e,parentId:c||null,success:!0}}catch(a){throw console.error("Error creating vector path:",a),new Error(`Failed to create vector path: ${a.message||a}`)}}async function Gt(r){const{x:e=0,y:n=0,width:i=120,height:o=40,text:c="Button",buttonStyle:a="primary",name:f="Button",parentId:d}=r||{};if(figma.editorType!=="figma")throw new Error("Node creation is only available in Design mode");try{const t=figma.createFrame();t.name=f,t.x=e,t.y=n,t.resize(i,o),t.layoutMode="HORIZONTAL",t.primaryAxisAlignItems="CENTER",t.counterAxisAlignItems="CENTER",t.paddingLeft=16,t.paddingRight=16,t.paddingTop=8,t.paddingBottom=8,t.cornerRadius=8;let s,l;switch(a){case"primary":s={r:0,g:.5,b:1},l={r:1,g:1,b:1};break;case"secondary":s={r:.9,g:.9,b:.9},l={r:0,g:0,b:0};break;case"outline":s={r:1,g:1,b:1},l={r:0,g:.5,b:1},t.strokes=[{type:"SOLID",color:{r:0,g:.5,b:1}}],t.strokeWeight=1;break;default:s={r:0,g:.5,b:1},l={r:1,g:1,b:1}}t.fills=[{type:"SOLID",color:s}];const g=figma.createText();if(await figma.loadFontAsync({family:"Inter",style:"Medium"}),g.name="Text",g.characters=c,g.fontSize=14,g.fills=[{type:"SOLID",color:l}],t.appendChild(g),d)try{const u=await figma.getNodeByIdAsync(d);if(!u)throw new Error(`Parent node not found with ID: ${d}`);if(!("appendChild"in u))throw new Error(`Parent node does not support children: ${d}`);u.appendChild(t)}catch(u){console.warn("Failed to add to parent, adding to current page:",u.message),figma.currentPage.appendChild(t)}else figma.currentPage.appendChild(t);return figma.currentPage.selection=[t],figma.viewport.scrollAndZoomIntoView([t]),{nodeId:t.id,id:t.id,name:t.name,type:t.type,x:t.x,y:t.y,width:t.width,height:t.height,text:c,buttonStyle:a,parentId:d||null,components:{container:t.id,text:g.id},success:!0}}catch(t){throw console.error("Error creating button:",t),new Error(`Failed to create button: ${t.message||t}`)}}async function Ht(r){const{operation:e="UNION",sourceNodeIds:n=[],name:i="Boolean Operation",parentId:o}=r||{};if(figma.editorType!=="figma")throw new Error("Node creation is only available in Design mode");if(!n||n.length<2)throw new Error("At least 2 source nodes are required for boolean operation");try{const c=[];for(const f of n){const d=await figma.getNodeByIdAsync(f);if(!d)throw new Error(`Source node not found with ID: ${f}`);if(!("fills"in d))throw new Error(`Node ${f} does not support boolean operations`);c.push(d)}const a=figma.createBooleanOperation();a.name=i,a.booleanOperation=e;for(const f of c){const d=f.clone();a.appendChild(d)}if(o)try{const f=await figma.getNodeByIdAsync(o);if(!f)throw new Error(`Parent node not found with ID: ${o}`);if(!("appendChild"in f))throw new Error(`Parent node does not support children: ${o}`);f.appendChild(a)}catch(f){console.warn("Failed to add to parent, adding to current page:",f.message),figma.currentPage.appendChild(a)}else figma.currentPage.appendChild(a);return figma.currentPage.selection=[a],figma.viewport.scrollAndZoomIntoView([a]),{nodeId:a.id,id:a.id,name:a.name,type:a.type,x:a.x,y:a.y,width:a.width,height:a.height,operation:e,sourceNodeIds:n,parentId:o||null,success:!0}}catch(c){throw console.error("Error creating boolean operation:",c),new Error(`Failed to create boolean operation: ${c.message||c}`)}}async function Zt(r){const{svgContent:e,pathData:n,x:i=0,y:o=0,width:c=24,height:a=24,name:f="Icon",parentId:d}=r||{};if(figma.editorType!=="figma")throw new Error("Node creation is only available in Design mode");if(!e&&!n)throw new Error("Either SVG content or path data is required");try{const t=figma.createFrame();t.name=f,t.x=i,t.y=o,t.resize(c,a),t.fills=[],t.clipsContent=!1;let s;if(n)s=figma.createVector(),s.name="Icon Path",s.vectorPaths=[{windingRule:"NONZERO",data:n}];else{s=figma.createVector(),s.name="Icon Vector";const l=e.match(/d="([^"]+)"/);if(l)s.vectorPaths=[{windingRule:"NONZERO",data:l[1]}];else throw new Error("Could not extract path data from SVG content")}if(s.fills=[{type:"SOLID",color:{r:0,g:0,b:0}}],s.resize(c,a),s.x=0,s.y=0,t.appendChild(s),d)try{const l=await figma.getNodeByIdAsync(d);if(!l)throw new Error(`Parent node not found with ID: ${d}`);if(!("appendChild"in l))throw new Error(`Parent node does not support children: ${d}`);l.appendChild(t)}catch(l){console.warn("Failed to add to parent, adding to current page:",l.message),figma.currentPage.appendChild(t)}else figma.currentPage.appendChild(t);return figma.currentPage.selection=[t],figma.viewport.scrollAndZoomIntoView([t]),{nodeId:t.id,id:t.id,name:t.name,type:t.type,x:t.x,y:t.y,width:t.width,height:t.height,svgContent:e||null,pathData:n||null,parentId:d||null,components:{container:t.id,vector:s.id},success:!0}}catch(t){throw console.error("Error creating icon from SVG:",t),new Error(`Failed to create icon from SVG: ${t.message||t}`)}}async function qt(r){try{const{x:e=0,y:n=0,width:i=200,height:o=40,placeholder:c="Enter text...",inputType:a="text",name:f=`Input Field ${Date.now()}`,parentId:d=null}=r,t=figma.createFrame();t.name=f,t.x=e,t.y=n,t.resize(i,o),t.layoutMode="HORIZONTAL",t.primaryAxisAlignItems="CENTER",t.counterAxisAlignItems="CENTER",t.paddingLeft=12,t.paddingRight=12,t.paddingTop=8,t.paddingBottom=8,t.cornerRadius=6,t.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}],t.strokes=[{type:"SOLID",color:{r:.8,g:.8,b:.8}}],t.strokeWeight=1;const s=figma.createText();if(await figma.loadFontAsync({family:"Inter",style:"Regular"}),s.fontName={family:"Inter",style:"Regular"},s.fontSize=14,s.characters=c,s.fills=[{type:"SOLID",color:{r:.6,g:.6,b:.6}}],s.layoutGrow=1,a==="password"?s.characters="••••••••":a==="email"?s.characters=c.includes("@")?c:"example@email.com":a==="number"&&(s.characters="123"),t.appendChild(s),d)try{const l=await figma.getNodeByIdAsync(d);if(!l)throw new Error(`Parent node not found with ID: ${d}`);if(!("appendChild"in l))throw new Error(`Parent node does not support children: ${d}`);l.appendChild(t)}catch(l){console.warn("Failed to add to parent, adding to current page:",l.message),figma.currentPage.appendChild(t)}else figma.currentPage.appendChild(t);return figma.currentPage.selection=[t],figma.viewport.scrollAndZoomIntoView([t]),{nodeId:t.id,id:t.id,name:t.name,type:t.type,x:t.x,y:t.y,width:t.width,height:t.height,placeholder:c,inputType:a,parentId:d||null,components:{container:t.id,text:s.id},success:!0}}catch(e){throw console.error("Error creating input field:",e),new Error(`Failed to create input field: ${e.message||e}`)}}async function Jt(r){try{const{x:e=0,y:n=0,width:i=120,height:o=24,label:c="Checkbox",checked:a=!1,name:f=`Checkbox ${Date.now()}`,parentId:d=null}=r,t=figma.createFrame();t.name=f,t.x=e,t.y=n,t.resize(i,o),t.layoutMode="HORIZONTAL",t.primaryAxisAlignItems="CENTER",t.counterAxisAlignItems="CENTER",t.itemSpacing=8,t.fills=[];const s=figma.createFrame();if(s.name="Checkbox Box",s.resize(16,16),s.cornerRadius=2,s.layoutSizingHorizontal="FIXED",s.layoutSizingVertical="FIXED",s.fills=[{type:"SOLID",color:a?{r:.2,g:.6,b:1}:{r:1,g:1,b:1}}],s.strokes=[{type:"SOLID",color:a?{r:.2,g:.6,b:1}:{r:.8,g:.8,b:.8}}],s.strokeWeight=1,a){const g=figma.createText();await figma.loadFontAsync({family:"Inter",style:"Regular"}),g.fontName={family:"Inter",style:"Regular"},g.fontSize=10,g.characters="✓",g.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}],g.textAlignHorizontal="CENTER",g.textAlignVertical="CENTER",g.x=3,g.y=1,s.appendChild(g)}const l=figma.createText();if(await figma.loadFontAsync({family:"Inter",style:"Regular"}),l.fontName={family:"Inter",style:"Regular"},l.fontSize=14,l.characters=c,l.fills=[{type:"SOLID",color:{r:.2,g:.2,b:.2}}],l.layoutGrow=1,t.appendChild(s),t.appendChild(l),d)try{const g=await figma.getNodeByIdAsync(d);if(!g)throw new Error(`Parent node not found with ID: ${d}`);if(!("appendChild"in g))throw new Error(`Parent node does not support children: ${d}`);g.appendChild(t)}catch(g){console.warn("Failed to add to parent, adding to current page:",g.message),figma.currentPage.appendChild(t)}else figma.currentPage.appendChild(t);return figma.currentPage.selection=[t],figma.viewport.scrollAndZoomIntoView([t]),{nodeId:t.id,id:t.id,name:t.name,type:t.type,x:t.x,y:t.y,width:t.width,height:t.height,label:c,checked:a,parentId:d||null,components:{container:t.id,box:s.id,label:l.id},success:!0}}catch(e){throw console.error("Error creating checkbox:",e),new Error(`Failed to create checkbox: ${e.message||e}`)}}async function Xt(r){try{const{x:e=0,y:n=0,width:i=100,height:o=32,label:c="Toggle",enabled:a=!1,name:f=`Toggle ${Date.now()}`,parentId:d=null}=r,t=figma.createFrame();t.name=f,t.x=e,t.y=n,t.resize(i,o),t.layoutMode="HORIZONTAL",t.primaryAxisAlignItems="CENTER",t.counterAxisAlignItems="CENTER",t.itemSpacing=8,t.fills=[];const s=figma.createFrame();s.name="Toggle Switch",s.resize(44,24),s.cornerRadius=12,s.layoutSizingHorizontal="FIXED",s.layoutSizingVertical="FIXED",s.layoutMode="HORIZONTAL",s.primaryAxisAlignItems="CENTER",s.counterAxisAlignItems="CENTER",s.paddingLeft=2,s.paddingRight=2,s.fills=[{type:"SOLID",color:a?{r:.2,g:.6,b:1}:{r:.9,g:.9,b:.9}}];const l=figma.createEllipse();l.name="Toggle Knob",l.resize(20,20),l.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}],a?l.x=22:l.x=2,l.y=2,s.appendChild(l);const g=figma.createText();if(await figma.loadFontAsync({family:"Inter",style:"Regular"}),g.fontName={family:"Inter",style:"Regular"},g.fontSize=14,g.characters=c,g.fills=[{type:"SOLID",color:{r:.2,g:.2,b:.2}}],g.layoutGrow=1,t.appendChild(s),t.appendChild(g),d)try{const u=await figma.getNodeByIdAsync(d);if(!u)throw new Error(`Parent node not found with ID: ${d}`);if(!("appendChild"in u))throw new Error(`Parent node does not support children: ${d}`);u.appendChild(t)}catch(u){console.warn("Failed to add to parent, adding to current page:",u.message),figma.currentPage.appendChild(t)}else figma.currentPage.appendChild(t);return figma.currentPage.selection=[t],figma.viewport.scrollAndZoomIntoView([t]),{nodeId:t.id,id:t.id,name:t.name,type:t.type,x:t.x,y:t.y,width:t.width,height:t.height,label:c,enabled:a,parentId:d||null,components:{container:t.id,switch:s.id,knob:l.id,label:g.id},success:!0}}catch(e){throw console.error("Error creating toggle:",e),new Error(`Failed to create toggle: ${e.message||e}`)}}async function Kt(r){try{const{sourceNodeId:e=null,name:n=`Symbol ${Date.now()}`,parentId:i=null}=r;let o=null;if(e&&(o=figma.root.findAll().find(t=>t.id===e)),!o){if(figma.currentPage.selection.length===0)throw new Error("No node selected to create symbol from");o=figma.currentPage.selection[0]}const c=o.clone(),a=figma.createComponent();a.name=n,a.appendChild(c),a.resizeWithoutConstraints(c.width,c.height);let f=figma.currentPage;if(i){const t=figma.root.findAll().find(s=>s.id===i&&"children"in s);t&&(f=t)}return f.appendChild(a),"x"in o&&"y"in o&&(a.x=o.x+o.width+20,a.y=o.y),figma.currentPage.selection=[a],figma.viewport.scrollAndZoomIntoView([a]),{result:{id:a.id,name:a.name,type:a.type,width:a.width,height:a.height,x:a.x,y:a.y},success:!0}}catch(e){throw console.error("Error creating symbol:",e),new Error(`Failed to create symbol: ${e.message||e}`)}}async function Yt(r){try{const{x:e=0,y:n=0,width:i=48,height:o=48,avatarType:c="initials",avatarText:a="AB",name:f=`Avatar ${Date.now()}`,parentId:d=null}=r,t=figma.createFrame();if(t.name=f,t.x=e,t.y=n,t.resizeWithoutConstraints(i,o),t.layoutMode="NONE",t.cornerRadius=i/2,t.clipsContent=!0,c==="image"){t.fills=[{type:"SOLID",color:{r:.9,g:.9,b:.9}}];const l=figma.createEllipse();l.name="Image Placeholder",l.resizeWithoutConstraints(i*.4,o*.4),l.x=i*.3,l.y=o*.3,l.fills=[{type:"SOLID",color:{r:.7,g:.7,b:.7}}],t.appendChild(l)}else{t.fills=[{type:"SOLID",color:{r:.3,g:.5,b:.8}}];const l=figma.createText();await figma.loadFontAsync({family:"Inter",style:"Medium"}),l.fontName={family:"Inter",style:"Medium"},l.characters=a,l.fontSize=Math.max(12,i*.4),l.fills=[{type:"SOLID",color:{r:1,g:1,b:1}}],l.textAlignHorizontal="CENTER",l.textAlignVertical="CENTER",l.x=(i-l.width)/2,l.y=(o-l.height)/2,t.appendChild(l)}let s=figma.currentPage;if(d){const g=figma.root.findAll().find(u=>u.id===d&&"children"in u);g&&(s=g)}return s.appendChild(t),figma.currentPage.selection=[t],figma.viewport.scrollAndZoomIntoView([t]),{result:{id:t.id,name:t.name,type:t.type,width:t.width,height:t.height,x:t.x,y:t.y,avatarType:c},success:!0}}catch(e){throw console.error("Error creating avatar:",e),new Error(`Failed to create avatar: ${e.message||e}`)}}async function jt(r){try{const{x:e=0,y:n=0,width:i=200,height:o=8,progress:c=50,progressStyle:a="linear",showProgressText:f=!0,name:d=`Progress Bar ${Date.now()}`,parentId:t=null}=r,s=figma.createFrame();if(s.name=d,s.x=e,s.y=n,s.layoutMode="NONE",a==="circular"){const g=Math.max(i,o);s.resizeWithoutConstraints(g,g);const u=figma.createEllipse();u.name="Background",u.resizeWithoutConstraints(g,g),u.fills=[],u.strokes=[{type:"SOLID",color:{r:.9,g:.9,b:.9}}],u.strokeWeight=g*.1,s.appendChild(u);const w=figma.createEllipse();if(w.name="Progress",w.resizeWithoutConstraints(g,g),w.fills=[],w.strokes=[{type:"SOLID",color:{r:.2,g:.6,b:1}}],w.strokeWeight=g*.1,s.appendChild(w),f){const p=figma.createText();await figma.loadFontAsync({family:"Inter",style:"Medium"}),p.fontName={family:"Inter",style:"Medium"},p.characters=`${c}%`,p.fontSize=g*.15,p.fills=[{type:"SOLID",color:{r:.2,g:.2,b:.2}}],p.textAlignHorizontal="CENTER",p.textAlignVertical="CENTER",p.x=(g-p.width)/2,p.y=(g-p.height)/2,s.appendChild(p)}}else{s.resizeWithoutConstraints(i,o);const g=figma.createRectangle();g.name="Background",g.resizeWithoutConstraints(i,o),g.cornerRadius=o/2,g.fills=[{type:"SOLID",color:{r:.9,g:.9,b:.9}}],s.appendChild(g);const u=figma.createRectangle();u.name="Progress";const w=i*c/100;if(u.resizeWithoutConstraints(w,o),u.cornerRadius=o/2,u.fills=[{type:"SOLID",color:{r:.2,g:.6,b:1}}],s.appendChild(u),f){const p=figma.createText();await figma.loadFontAsync({family:"Inter",style:"Regular"}),p.fontName={family:"Inter",style:"Regular"},p.characters=`${c}%`,p.fontSize=Math.max(10,o*.7),p.fills=[{type:"SOLID",color:{r:.2,g:.2,b:.2}}],p.x=i+8,p.y=(o-p.height)/2,s.appendChild(p),s.resizeWithoutConstraints(i+p.width+8,o)}}let l=figma.currentPage;if(t){const u=figma.root.findAll().find(w=>w.id===t&&"children"in w);u&&(l=u)}return l.appendChild(s),figma.currentPage.selection=[s],figma.viewport.scrollAndZoomIntoView([s]),{result:{id:s.id,name:s.name,type:s.type,width:s.width,height:s.height,x:s.x,y:s.y,progress:c,progressStyle:a},success:!0}}catch(e){throw console.error("Error creating progress bar:",e),new Error(`Failed to create progress bar: ${e.message||e}`)}}async function Qt(r){const{svgContent:e,x:n=0,y:i=0,width:o,height:c,name:a=`SVG Vector ${Date.now()}`,parentId:f=null}=r||{};if(figma.editorType!=="figma")throw new Error("Node creation is only available in Design mode");if(!e)throw new Error("SVG content is required");try{const d=figma.createFrame();d.name=a,d.x=n,d.y=i,d.fills=[],d.clipsContent=!1;try{const t=figma.createNodeFromSvg(e);o&&c?(d.resize(o,c),"resize"in t&&t.resize(o,c)):"width"in t&&"height"in t?d.resize(t.width,t.height):d.resize(100,100),t.name=`${a} SVG`,t.x=0,t.y=0,d.appendChild(t)}catch(t){if(console.warn("figma.createNodeFromSvg failed, using fallback method:",t),!e.match(/<svg[^>]*>/i))throw new Error("Invalid SVG content: No SVG element found");let l=o,g=c;if(!o||!c){const w=e.match(/viewBox=["']([^"']+)["']/i),p=e.match(/width=["']([^"']+)["']/i),y=e.match(/height=["']([^"']+)["']/i);if(w){const b=w[1].split(/\s+/);l=l||parseFloat(b[2])||100,g=g||parseFloat(b[3])||100}else p&&y?(l=l||parseFloat(p[1])||100,g=g||parseFloat(y[1])||100):(l=l||100,g=g||100)}d.resize(l,g);const u=e.match(/<path[^>]*d=["']([^"']+)["'][^>]*>/gi);if(u&&u.length>0)try{const w=u[0].match(/d=["']([^"']+)["']/i);if(w){const p=w[1],y=figma.createVector();y.name=`${a} Vector`;try{y.vectorPaths=[{windingRule:"NONZERO",data:p}];const b=e.match(/fill=["']([^"']+)["']/i),E=e.match(/stroke=["']([^"']+)["']/i),C=e.match(/stroke-width=["']([^"']+)["']/i);if(b&&b[1]!=="none"){const $=Pe(b[1]);$&&(y.fills=[{type:"SOLID",color:$}])}if(E&&E[1]!=="none"){const $=Pe(E[1]),T=C?parseFloat(C[1]):1;$&&(y.strokes=[{type:"SOLID",color:$}],y.strokeWeight=T)}d.appendChild(y)}catch(b){console.warn("Failed to set vector path:",b);const E=figma.createRectangle();E.name=`${a} Fallback`,E.resize(l,g),E.fills=[{type:"SOLID",color:{r:.8,g:.8,b:.8}}],d.appendChild(E)}}}catch(w){console.warn("Fallback method failed:",w);const p=figma.createFrame();p.name=`${a} Placeholder`,p.resize(l||100,g||100),p.fills=[{type:"SOLID",color:{r:.9,g:.9,b:.9}}],d.appendChild(p)}else{const w=figma.createFrame();w.name=`${a} No Path`,w.resize(l,g),w.fills=[{type:"SOLID",color:{r:.7,g:.7,b:.7}}],d.appendChild(w)}}if(f)try{const t=await figma.getNodeByIdAsync(f);if(!t)throw new Error(`Parent node not found with ID: ${f}`);if(!("appendChild"in t))throw new Error(`Parent node does not support children: ${f}`);t.appendChild(d)}catch(t){console.warn("Failed to add to parent, adding to current page:",t.message),figma.currentPage.appendChild(d)}else figma.currentPage.appendChild(d);return figma.currentPage.selection=[d],figma.viewport.scrollAndZoomIntoView([d]),{nodeId:d.id,id:d.id,name:d.name,type:d.type,x:d.x,y:d.y,width:d.width,height:d.height,childrenCount:d.children.length,success:!0}}catch(d){throw console.error("Error creating SVG vector:",d),new Error(`Failed to create SVG vector: ${d.message||d}`)}}async function eo(r){const{customJson:e}=r||{};if(!e)throw new Error("Custom JSON is required");try{let n;typeof e=="string"?n=JSON.parse(e):n=e;const{command:i,params:o}=n;if(!i)throw new Error('The "command" property is missing in the custom JSON.');return await De(i,o)}catch(n){throw console.error("Error executing custom command:",n),new Error(`Failed to execute custom command: ${n.message||n}`)}}function Pe(r){if(!r||r==="none")return null;if(r.startsWith("#")){const i=r.substring(1);if(i.length===3){const o=parseInt(i[0]+i[0],16)/255,c=parseInt(i[1]+i[1],16)/255,a=parseInt(i[2]+i[2],16)/255;return{r:o,g:c,b:a}}else if(i.length===6){const o=parseInt(i.substring(0,2),16)/255,c=parseInt(i.substring(2,4),16)/255,a=parseInt(i.substring(4,6),16)/255;return{r:o,g:c,b:a}}}const e=r.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);return e?{r:parseInt(e[1])/255,g:parseInt(e[2])/255,b:parseInt(e[3])/255}:{black:{r:0,g:0,b:0},white:{r:1,g:1,b:1},red:{r:1,g:0,b:0},green:{r:0,g:1,b:0},blue:{r:0,g:0,b:1},yellow:{r:1,g:1,b:0},cyan:{r:0,g:1,b:1},magenta:{r:1,g:0,b:1}}[r.toLowerCase()]||null}async function to(r){const{nodeIds:e=[],name:n=`Group ${Date.now()}`,parentId:i=null}=r||{};if(!e||e.length===0)throw new Error("At least one node ID is required to create a group");try{const o=Array.isArray(e)?e:e.split(",").map(d=>d.trim()),c=[];for(const d of o){const t=await figma.getNodeByIdAsync(d);if(!t)throw new Error(`Node with ID '${d}' not found`);if(!("x"in t&&"y"in t&&"width"in t&&"height"in t))throw new Error(`Node '${d}' cannot be grouped (not a valid scene node type)`);c.push(t)}let a;if(i){if(a=await figma.getNodeByIdAsync(i),!a)throw new Error(`Parent node with ID '${i}' not found`)}else a=figma.currentPage;const f=figma.group(c,a);return f.name=n,figma.currentPage.selection=[f],figma.viewport.scrollAndZoomIntoView([f]),{nodeId:f.id,id:f.id,name:f.name,type:f.type,x:f.x,y:f.y,width:f.width,height:f.height,childrenCount:f.children.length,groupedNodes:o,success:!0}}catch(o){throw console.error("Error creating group:",o),new Error(`Failed to create group: ${o.message||o}`)}}We();
